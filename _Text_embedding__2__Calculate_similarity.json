{
  "name": "(Text embedding) 2. Calculate similarity",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -340,
        40
      ],
      "id": "d14772f6-c0f8-4d1b-bfef-9d2720fa7c75",
      "name": "When clicking 'Test workflow'"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://localhost:11434/api/embed",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={\n    \"model\": \"chevalblanc/acge_text_embedding:latest\",\n    \"input\": [\"{{ $json.text1 }}\", \"{{ $json.text2 }}\", \"{{ $json.text3 }}\"]\n}\n"
      },
      "name": "Call Ollama Embedding API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        260,
        100
      ],
      "id": "5018a48f-62d7-40c5-b456-6425ac88fffa"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import numpy as np\nfrom itertools import combinations\n\n# å–å¾— API å›å‚³çš„ embedding å‘é‡\nembeddings = items[0][\"json\"][\"embeddings\"]\n\nvectors = []\n# è½‰æˆç´” Python list\nfor idx in range(len(embeddings)):\n    vec = list(embeddings[idx])  \n    vectors.append(vec)\n\n# å®šç¾© cosine similarity\ndef cosine_similarity(vec1, vec2):\n    vec1 = np.array(vec1)\n    vec2 = np.array(vec2)\n    return float(np.dot(vec1, vec2) / (np.linalg.norm(vec1) * np.linalg.norm(vec2)))\n\n# è¨ˆç®—æ¯ä¸€å°å‘é‡çš„ç›¸ä¼¼åº¦\nresults = []\nfor (i1, v1), (i2, v2) in combinations(enumerate(vectors), 2):\n    sim = cosine_similarity(v1, v2)\n    results.append({\n        \"pair\": f\"{i1}-{i2}\",\n        \"similarity\": sim\n    })\n\n# è¼¸å‡ºçµæœ\nreturn results"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        500,
        100
      ],
      "id": "c6f19dc9-f0a9-424c-a889-c6acab08c389",
      "name": "è¨ˆç®— text èˆ‡ prompt ç›¸ä¼¼åº¦"
    },
    {
      "parameters": {
        "content": "### è¼¸å…¥ 3 æ®µæ–‡æœ¬, ç”¨ embedding vectorè¨ˆç®—æ–‡æœ¬çš„ç›¸ä¼¼åº¦",
        "height": 80,
        "width": 340
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -260,
        -100
      ],
      "typeVersion": 1,
      "id": "99b0a2f2-7b1c-47e8-b034-8047c7ade85b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import numpy as np\nfrom itertools import combinations\n\n# å–å¾— API å›å‚³çš„ embedding å‘é‡\nembeddings = items[0][\"json\"][\"data\"]\nvectors = []\n\n# è½‰æˆç´” Python list\nfor idx in range(len(embeddings)):\n    vec = list(embeddings[idx][\"embedding\"])  # ğŸ‘ˆ åŠ ä¸Š list()\n    vectors.append(vec)\n\n# å®šç¾© cosine similarity\ndef cosine_similarity(vec1, vec2):\n    vec1 = np.array(vec1)\n    vec2 = np.array(vec2)\n    return float(np.dot(vec1, vec2) / (np.linalg.norm(vec1) * np.linalg.norm(vec2)))\n\n# è¨ˆç®—æ¯ä¸€å°å‘é‡çš„ç›¸ä¼¼åº¦\nresults = []\nfor (i1, v1), (i2, v2) in combinations(enumerate(vectors), 2):\n    sim = cosine_similarity(v1, v2)\n    results.append({\n        \"pair\": f\"{i1}-{i2}\",\n        \"similarity\": sim\n    })\n\n# è¼¸å‡ºçµæœ\nreturn results"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        500,
        -100
      ],
      "id": "87a253fb-8c0c-494d-9bb1-832dbbbf9192",
      "name": "è¨ˆç®— text èˆ‡ prompt ç›¸ä¼¼åº¦1"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "text1",
              "value": "AI èˆ‡åŠå°é«”"
            },
            {
              "name": "text2",
              "value": "è¬›å¸«å¾å¢¨è¥¿å“¥æ¼å¤«çš„æ•…äº‹é–‹å§‹ï¼Œæœ‰ä¸€å€‹å¯Œæœ‰çš„éŠ€è¡Œå®¶åœ¨å¢¨è¥¿å“¥æ¸¡å‡ï¼Œä»–è¦ºå¾—æ¯å¤©åªé‡£ä¸€éš»é­šçš„äººä¸è°æ˜ï¼Œæ‡‰è©²é‡£å¾ˆå¤šå»é–‹ä¸€å€‹ç½é ­ç”¢æ¥­ï¼Œç„¶å¾Œé–‹å§‹äº«ç¦ï¼Œä½†æ¼å¤«æ­£æ˜¯æ­£åœ¨é€™æ¨£çš„æ™‚æ®µã€‚éåº¦è¿½æ±‚æˆåŠŸï¼Œåè€Œå¿½ç•¥çœŸæ­£é‡è¦çš„äº‹æƒ…ã€‚é‡åˆ°å›°é›£çš„æ™‚å€™ï¼Œæ‰€åšå‡ºçš„æ±ºå®šï¼Œç¾åœ¨å›å»çœ‹å…¶å¯¦ä¹Ÿæ²’æœ‰å¤ªå¤§çš„æ„ç¾©äº†å§ï¼Œå› ç‚ºå†ä¾†ä¸€æ¬¡ï¼Œæœƒé¸ä¸€æ¨£çš„é¸æ“‡ï¼Œæ²’æœ‰å¥½æˆ–å£ï¼Œè¦å°è‡ªå·±çš„é¸æ“‡æ‰¿æ“”å°±å¥½äº†ã€‚åšä¸åˆ°ä¸€ä»¶äº‹æƒ…ä¸æ‡‰è©²ä¸€ç›´ç‚ºè‡ªå·±æ‰¾ç†ç”±ï¼Œè€Œæ˜¯æ‡‰è©²æ›´åŠªåŠ›çš„å»æŒ‘æˆ°ä»–ï¼Œç­‰ä½ æˆåŠŸäº†ï¼Œç²å¾—æˆå°±æ„Ÿäº†ï¼Œé‚£ä½ å°±å¯ä»¥å‘Šè¨´å¤§å®¶ä½ å¾ˆåŠªåŠ›å¾ˆåŠªåŠ›ä¹‹å¾ŒæˆåŠŸäº†ã€‚å¦‚æœä¸€å€‹äººå¾ˆå–œæ­¡é€™ä»¶äº‹æƒ…ï¼Œé‚£å°±æœƒå»¢å¯¢å¿˜é£Ÿçš„æ™‚å€™å»åŠªåŠ›åšå®Œï¼Œé‚£ç•¶æˆ‘å€‘æ‰¾åˆ°è‡ªå·±ç†±æ„›çš„å·¥ä½œä¹‹å¾Œï¼Œå°±å¥½å¥½çš„èªçœŸçš„å®Œæˆã€‚ç•¶ä½ ä¸å–œæ­¡é€™ä»½å·¥ä½œçš„æ™‚å€™ï¼Œå°±è¦æƒ³æƒ³è¦ä¸è¦è½‰æ›è·‘é“ï¼Œä¸è¦é‚Šåšé‚ŠæŠ±æ€¨ï¼Œç‚ºç”Ÿæ´»è€Œå·¥ä½œè½‰åŒ–æˆç‚ºå¿«æ¨‚è€Œå·¥ä½œã€‚"
            },
            {
              "name": "text3",
              "value": "åƒèˆ‡äº†ä¸€å ´é—œæ–¼ã€ŒåŠå°é«”èˆ‡AIç™¼å±•ã€çš„å°ˆé¡Œè¬›åº§ï¼Œè¬›åº§å…§å®¹æ¶µè“‹åŠå°é«”è£½ç¨‹æŠ€è¡“çš„é€²æ­¥ã€AIå°åŠå°é«”å¸‚å ´çš„éœ€æ±‚è®ŠåŒ–ã€ç”¢æ¥­ä¾›æ‡‰éˆåˆ†æï¼Œä»¥åŠæœªä¾†ç™¼å±•è¶¨å‹¢ã€‚è¬›å¸«é‚„åˆ†äº«äº†AIé‹ç®—å°é«˜æ•ˆèƒ½æ™¶ç‰‡ï¼ˆå¦‚GPUã€TPUã€NPUç­‰ï¼‰çš„éœ€æ±‚ï¼Œä»¥åŠåŠå°é«”ç”¢æ¥­åœ¨å…¨çƒç§‘æŠ€ç«¶çˆ­ä¸­çš„é—œéµè§’è‰²ã€‚æ­¤å¤–ï¼Œé‚„åƒèˆ‡äº†å•ç­”ç’°ç¯€ï¼Œèˆ‡è¬›å¸«åŠå…¶ä»–åƒèˆ‡è€…äº¤æµè§€é»ã€‚"
            }
          ]
        },
        "options": {}
      },
      "name": "è¼¸å…¥æ–‡æœ¬",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        -120,
        40
      ],
      "id": "07332c09-a5a2-449c-ad5e-cd0ef7f7b929"
    },
    {
      "parameters": {
        "content": "0-1, 0.130\n0-2, 0.582\n1-2, 0.241",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        720,
        -80
      ],
      "id": "52a0c2d1-1b83-4669-8200-c2d9ad9f79de",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "0-1, 0.125\n0-2, 0.762\n1-2, 0.266",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        720,
        100
      ],
      "id": "bef6c310-eb45-4792-b20f-0a6b64197009",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/embeddings",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\":  \"text-embedding-3-small\",\n  \"input\": \"{{ $json.text }}\"\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        260,
        -100
      ],
      "id": "648e59fb-c4f1-4ca4-976c-de2cad688f75",
      "name": "Call OpenAI embeddimg model"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking 'Test workflow'": {
      "main": [
        [
          {
            "node": "è¼¸å…¥æ–‡æœ¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Ollama Embedding API": {
      "main": [
        [
          {
            "node": "è¨ˆç®— text èˆ‡ prompt ç›¸ä¼¼åº¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¼¸å…¥æ–‡æœ¬": {
      "main": [
        [
          {
            "node": "Call Ollama Embedding API",
            "type": "main",
            "index": 0
          },
          {
            "node": "Call OpenAI embeddimg model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call OpenAI embeddimg model": {
      "main": [
        [
          {
            "node": "è¨ˆç®— text èˆ‡ prompt ç›¸ä¼¼åº¦1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "36485c57-70bb-403f-b587-778334314ff3",
  "meta": {
    "instanceId": "ed4784af1f74bbc62add1178f4aebb26503cdf990ea025c651402f03e02f9665"
  },
  "id": "pgqpjK9NUUQcHboQ",
  "tags": []
}